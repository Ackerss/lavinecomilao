<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>O Monstro Comil√£o - Para Lavine</title>
    <style>
        /* --- ESTILOS GERAIS --- */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f8ff;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* --- O MONSTRO --- */
        #monster-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 350px;
            z-index: 5;
            transition: transform 0.5s ease;
            pointer-events: none; /* Permite arrastar frutas por cima */
        }

        /* √Årea da boca para detec√ß√£o */
        #mouth-sensor {
            position: absolute;
            top: 80px;
            left: 75px;
            width: 150px;
            height: 80px;
            z-index: 10;
        }

        /* Express√£o de enjoo (Hora do coc√¥) */
        .sick-face #monster-body { fill: #a8d5ba !important; } /* Pele meio verde */
        .sick-face .eye-pupil { transform: scale(0.5); }
        .sick-face .mouth-path { d: path("M75 150 Q110 140 150 150 Q190 160 225 150"); fill: none; stroke: #333; stroke-width: 5; }
        .sick-face .teeth { display: none; }

        /* --- LIQUIDIFICADOR (MODO VITAMINA) --- */
        #blender-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 140px;
            height: 200px;
            z-index: 4;
            display: none; /* Oculto por padr√£o */
            transition: transform 0.3s;
        }

        #blender-sensor {
            position: absolute;
            top: 0;
            left: 10;
            width: 120px;
            height: 150px;
            z-index: 10;
        }

        .blender-active #monster-container {
            left: 30%; /* Move monstro para esquerda no modo vitamina */
        }
        
        .blender-shaking {
            animation: shake 0.5s infinite;
        }

        /* --- CONTROLES LATERAIS --- */
        #controls-sidebar {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 50;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            border: 4px solid #3498db;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 0 #2980b9;
            transition: transform 0.1s;
        }
        .control-btn:active { transform: translateY(4px); box-shadow: none; }
        .control-btn svg { width: 35px; height: 35px; fill: #333; }
        .btn-active { background: #ffeaa7; border-color: #f1c40f; box-shadow: 0 4px 0 #d35400; }

        /* Bot√£o de Coc√¥ (Aparece s√≥ quando precisa) */
        #poop-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 80px;
            height: 80px;
            background: #fff;
            border-radius: 50%;
            border: 4px solid #e74c3c;
            display: none; /* Escondido */
            justify-content: center;
            align-items: center;
            z-index: 60;
            animation: pulse 1s infinite;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* --- UI E TEXTOS --- */
        #ui-layer {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 20;
            pointer-events: none;
        }

        #instruction-bubble {
            background: white;
            padding: 15px 25px;
            border-radius: 30px;
            display: inline-block;
            border: 3px solid #333;
            font-size: 1.5rem;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.1);
            max-width: 80%;
        }

        .highlight-num { color: #e74c3c; font-weight: bold; font-size: 1.8rem; }

        /* --- FRUTAS --- */
        .fruit {
            width: 65px;
            height: 65px;
            position: absolute;
            cursor: grab;
            z-index: 30;
            filter: drop-shadow(2px 4px 3px rgba(0,0,0,0.2));
            transition: transform 0.1s;
        }
        .fruit:active { cursor: grabbing; transform: scale(1.1); }

        /* --- TELAS --- */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(46, 204, 113, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .big-btn {
            background: #fff; color: #2ecc71;
            border: none; padding: 20px 60px;
            font-size: 2rem; border-radius: 50px;
            cursor: pointer; box-shadow: 0 8px 0 #27ae60;
            font-weight: bold;
        }
        .big-btn:active { transform: translateY(8px); box-shadow: none; }

        /* --- ANIMA√á√ïES --- */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

    </style>
</head>
<body>

    <!-- TELA INICIAL -->
    <div id="start-screen">
        <h1 style="color:white; font-size: 3rem; text-shadow: 2px 2px 0 #000;">Monstro Comil√£o</h1>
        <button class="big-btn" onclick="startGame()">JOGAR</button>
        <p style="color:white; margin-top:20px;">Para a Lavine ‚ù§Ô∏è</p>
    </div>

    <!-- CONTROLES LATERAIS -->
    <div id="controls-sidebar">
        <!-- Bot√£o Vitamina -->
        <div id="btn-blender" class="control-btn" onclick="toggleBlenderMode()" title="Fazer Vitamina">
            <svg viewBox="0 0 24 24">
                <path d="M19,19H5V8H19M19,8V6A2,2 0 0,0 17,4H7A2,2 0 0,0 5,6V8M19,19A2,2 0 0,1 17,21H7A2,2 0 0,1 5,19M9,13H15" fill="#333"/>
            </svg>
        </div>
    </div>

    <!-- BOT√ÉO DE COC√î (ESCONDIDO) -->
    <div id="poop-btn" onclick="doPoop()">
        <span style="font-size: 40px;">üí©</span>
    </div>

    <div id="game-container">
        
        <!-- TEXTO DE INSTRU√á√ÉO -->
        <div id="ui-layer">
            <div id="instruction-bubble">Clique em JOGAR!</div>
        </div>

        <!-- O MONSTRO -->
        <div id="monster-container">
            <div id="mouth-sensor"></div>
            <svg id="monster-svg" viewBox="0 0 300 350" xmlns="http://www.w3.org/2000/svg">
                <!-- Corpo -->
                <path id="monster-body" d="M50 300 Q20 350 80 340 L220 340 Q280 350 250 300 Q280 200 250 100 Q230 20 150 20 Q70 20 50 100 Q20 200 50 300" fill="#7bed9f" stroke="#2ecc71" stroke-width="5"/>
                
                <!-- Barriga -->
                <circle cx="150" cy="250" r="60" fill="rgba(255,255,255,0.4)" stroke="#fff" stroke-width="3" />
                
                <!-- Olhos -->
                <g id="eyes">
                    <circle cx="100" cy="100" r="25" fill="white" stroke="#333" stroke-width="2"/>
                    <circle cx="200" cy="100" r="25" fill="white" stroke="#333" stroke-width="2"/>
                    <circle class="eye-pupil" id="eye-left" cx="100" cy="100" r="10" fill="black" />
                    <circle class="eye-pupil" id="eye-right" cx="200" cy="100" r="10" fill="black" />
                </g>
                
                <!-- Boca Normal -->
                <g id="mouth-group">
                    <path class="mouth-path" d="M75 130 Q150 130 225 130 Q225 180 150 180 Q75 180 75 130 Z" fill="#333" />
                    <path class="teeth" d="M85 130 L95 145 L105 130 M195 130 L205 145 L215 130" stroke="white" stroke-width="3" fill="white"/>
                </g>

                <!-- Bra√ßos -->
                <path d="M60 200 Q20 220 30 180" stroke="#2ecc71" stroke-width="15" stroke-linecap="round" fill="none"/>
                <path d="M240 200 Q280 220 270 180" stroke="#2ecc71" stroke-width="15" stroke-linecap="round" fill="none"/>
            </svg>
        </div>

        <!-- LIQUIDIFICADOR -->
        <div id="blender-container">
            <div id="blender-sensor"></div>
            <svg viewBox="0 0 140 200">
                <!-- Copo -->
                <path d="M20 40 L30 160 Q35 180 70 180 Q105 180 110 160 L120 40 Z" fill="rgba(200, 230, 255, 0.6)" stroke="#3498db" stroke-width="3"/>
                <!-- Tampa -->
                <rect x="15" y="30" width="110" height="15" rx="5" fill="#333"/>
                <!-- Base -->
                <rect x="25" y="180" width="90" height="20" fill="#e74c3c"/>
                <!-- Conte√∫do (L√≠quido) -->
                <path id="blender-liquid" d="M25 160 Q35 175 70 175 Q105 175 115 160 L118 100 Q70 110 22 100 Z" fill="#e67e22" opacity="0"/>
            </svg>
        </div>

    </div>

    <!-- SCRIPT DO JOGO -->
    <script>
        // --- DADOS DAS FRUTAS (SVGs INLINE) ---
        const fruitsData = {
            'morango': { color: '#e74c3c', shape: '<path d="M35 10 Q55 10 60 25 Q65 60 35 70 Q5 60 10 25 Q15 10 35 10 Z" fill="#e74c3c" stroke="#c0392b"/><path d="M35 10 L30 5 M35 10 L40 5 M35 10 L35 2" stroke="green" stroke-width="3"/>' },
            'banana': { color: '#f1c40f', shape: '<path d="M10 50 Q35 70 60 20 Q65 15 60 15 Q40 60 10 40 Z" fill="#f1c40f" stroke="#f39c12" stroke-width="2"/>' },
            'ma√ß√£': { color: '#c0392b', shape: '<circle cx="35" cy="40" r="25" fill="#c0392b"/><path d="M35 15 Q45 5 45 15" fill="none" stroke="green" stroke-width="3"/>' },
            'uva': { color: '#8e44ad', shape: '<circle cx="35" cy="50" r="10" fill="#8e44ad"/><circle cx="25" cy="35" r="10" fill="#8e44ad"/><circle cx="45" cy="35" r="10" fill="#8e44ad"/><circle cx="35" cy="20" r="10" fill="#8e44ad"/>' },
            'laranja': { color: '#e67e22', shape: '<circle cx="35" cy="35" r="30" fill="#e67e22" stroke="#d35400"/><circle cx="35" cy="35" r="2" fill="#d35400" opacity="0.5"/><circle cx="20" cy="25" r="1" fill="#d35400" opacity="0.5"/><circle cx="50" cy="45" r="1" fill="#d35400" opacity="0.5"/>' },
            'pera': { color: '#badc58', shape: '<path d="M35 5 Q55 10 55 45 Q55 65 35 65 Q15 65 15 45 Q15 10 35 5 Z" fill="#badc58" stroke="#6ab04c"/><path d="M35 5 L35 0" stroke="#5d4037" stroke-width="3"/>' },
            'melancia': { color: '#2ecc71', shape: '<path d="M5 20 Q35 65 65 20" fill="#ff6b6b" stroke="#2ecc71" stroke-width="4"/><circle cx="35" cy="35" r="2" fill="black"/><circle cx="25" cy="25" r="2" fill="black"/><circle cx="45" cy="25" r="2" fill="black"/>' },
            'abacaxi': { color: '#f9ca24', shape: '<ellipse cx="35" cy="45" rx="20" ry="25" fill="#f9ca24" stroke="#f0932b"/><path d="M35 20 L25 5 L30 10 L35 0 L40 10 L45 5 L35 20" fill="green"/>' },
            'lim√£o': { color: '#6ab04c', shape: '<ellipse cx="35" cy="35" rx="25" ry="20" fill="#badc58" stroke="#6ab04c"/>' }
        };

        // --- ESTADO DO JOGO ---
        let state = {
            mode: 'normal', // 'normal' ou 'blender'
            targetCount: 0, // Frutas restantes para pedir
            targetType: '', // Tipo atual no modo normal
            blenderRecipe: {}, // Ex: { banana: 2, morango: 1 } no modo vitamina
            blenderContent: [], // O que j√° foi colocado
            poopMeter: 0, // 0 a 100. 100 = precisa fazer coc√¥
            isPlaying: false,
            needsPoop: false
        };

        const MAX_POOP = 6; // Quantidade de frutas/vitaminas at√© dar vontade de ir ao banheiro

        // Elementos DOM
        const els = {
            instruction: document.getElementById('instruction-bubble'),
            monster: document.getElementById('monster-container'),
            blender: document.getElementById('blender-container'),
            blenderSensor: document.getElementById('blender-sensor'),
            blenderLiquid: document.getElementById('blender-liquid'),
            mouthSensor: document.getElementById('mouth-sensor'),
            poopBtn: document.getElementById('poop-btn'),
            gameContainer: document.getElementById('game-container'),
            btnBlender: document.getElementById('btn-blender')
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- √ÅUDIO E FALA ---
        function speak(text, queue = false) {
            if (!queue) window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pt-BR';
            utterance.rate = 1.1; 
            
            const voices = window.speechSynthesis.getVoices();
            // Tenta pegar a voz da Luciana ou Google
            const preferredVoice = voices.find(v => v.name.includes('Google Portugu√™s') || v.name.includes('Luciana'));
            if(preferredVoice) utterance.voice = preferredVoice;

            window.speechSynthesis.speak(utterance);
        }

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'pop') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(); osc.stop(now + 0.1);
            } else if (type === 'eat') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                osc.start(); osc.stop(now + 0.15);
            } else if (type === 'blender') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.linearRampToValueAtTime(150, now + 1.5);
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 1.5);
                osc.start(); osc.stop(now + 1.5);
            } else if (type === 'fart') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.4);
                gainNode.gain.setValueAtTime(0.5, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(); osc.stop(now + 0.4);
            } else if (type === 'flush') {
                // Som de descarga (ru√≠do branco simulado)
                const bufferSize = audioCtx.sampleRate * 1;
                const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                const noiseGain = audioCtx.createGain();
                noiseGain.gain.setValueAtTime(0.5, now);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 1);
                
                noise.connect(noiseGain);
                noiseGain.connect(audioCtx.destination);
                noise.start();
            }
        }

        // --- CONTROLE DE FLUXO ---
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            if (audioCtx.state === 'suspended') audioCtx.resume();
            startRound();
        }

        function toggleBlenderMode() {
            if (state.needsPoop) return; // N√£o troca se precisar fazer coc√¥

            state.mode = (state.mode === 'normal') ? 'blender' : 'normal';
            
            if (state.mode === 'blender') {
                els.monster.classList.add('sick-face'); // Reusa a classe sick-face momentaneamente ou cria outra se quiser
                els.blender.style.display = 'block';
                document.body.classList.add('blender-active');
                els.btnBlender.classList.add('btn-active');
                els.monster.classList.remove('sick-face'); // Remove logo, foi s√≥ teste
            } else {
                els.blender.style.display = 'none';
                document.body.classList.remove('blender-active');
                els.btnBlender.classList.remove('btn-active');
            }
            startRound();
        }

        function checkPoopStatus() {
            if (state.poopMeter >= MAX_POOP) {
                state.needsPoop = true;
                els.monster.classList.add('sick-face');
                els.instruction.innerHTML = "Ai minha barriga! Preciso fazer coc√¥!";
                speak("Ai ai ai, minha barriga! Preciso fazer coc√¥!");
                els.poopBtn.style.display = 'flex';
                
                // Limpa frutas
                document.querySelectorAll('.fruit').forEach(el => el.remove());
                return true;
            }
            return false;
        }

        function doPoop() {
            playSound('fart');
            setTimeout(() => playSound('flush'), 500);
            
            state.poopMeter = 0;
            state.needsPoop = false;
            els.poopBtn.style.display = 'none';
            els.monster.classList.remove('sick-face');
            
            speak("Ufa! Que al√≠vio! Agora estou com fome de novo.");
            
            setTimeout(() => {
                startRound();
            }, 3000);
        }

        function startRound() {
            if (checkPoopStatus()) return;

            state.isPlaying = true;
            document.querySelectorAll('.fruit').forEach(el => el.remove());

            if (state.mode === 'normal') {
                setupNormalRound();
            } else {
                setupBlenderRound();
            }
            
            moveEyes();
        }

        // --- L√ìGICA MODO NORMAL ---
        function setupNormalRound() {
            const types = Object.keys(fruitsData);
            state.targetType = types[Math.floor(Math.random() * types.length)];
            state.targetCount = Math.floor(Math.random() * 3) + 1; // 1 a 3 frutas

            const plural = state.targetCount > 1 ? 's' : '';
            const msg = `Quero <span class="highlight-num">${state.targetCount}</span> ${capitalize(state.targetType)}${plural}!`;
            
            els.instruction.innerHTML = msg;
            speak(`Eu quero ${state.targetCount} ${state.targetType}${plural}`);

            spawnFruits(10);
        }

        // --- L√ìGICA MODO VITAMINA ---
        function setupBlenderRound() {
            // Cria receita: 2 ingredientes
            const types = Object.keys(fruitsData);
            const type1 = types[Math.floor(Math.random() * types.length)];
            let type2 = types[Math.floor(Math.random() * types.length)];
            while(type1 === type2) type2 = types[Math.floor(Math.random() * types.length)];

            const count1 = Math.floor(Math.random() * 2) + 1;
            const count2 = Math.floor(Math.random() * 2) + 1;

            state.blenderRecipe = { [type1]: count1, [type2]: count2 };
            state.blenderContent = []; // Zera conte√∫do atual
            els.blenderLiquid.style.opacity = 0; // Esvazia copo

            // Monta frase
            const txt1 = `${count1} ${capitalize(type1)}${count1>1?'s':''}`;
            const txt2 = `${count2} ${capitalize(type2)}${count2>1?'s':''}`;
            
            els.instruction.innerHTML = `Vitamina: <span class="highlight-num">${txt1}</span> e <span class="highlight-num">${txt2}</span>`;
            speak(`Vamos fazer vitamina de ${type1} com ${type2}. Coloque tudo no liquidificador!`);

            spawnFruits(12);
        }

        function spawnFruits(qtd) {
            for(let i=0; i<qtd; i++) {
                // Se for normal, garante algumas frutas certas. Se vitamina, garante ingredientes.
                let type;
                const types = Object.keys(fruitsData);
                
                if (Math.random() > 0.3) {
                    // Chance maior de vir o que precisa
                    if (state.mode === 'normal') {
                        type = state.targetType;
                    } else {
                        const ingredients = Object.keys(state.blenderRecipe);
                        type = ingredients[Math.floor(Math.random() * ingredients.length)];
                    }
                } else {
                    type = types[Math.floor(Math.random() * types.length)];
                }
                
                createFruit(type);
            }
        }

        function createFruit(type) {
            const el = document.createElement('div');
            el.className = 'fruit';
            el.dataset.type = type;
            el.innerHTML = `<svg viewBox="0 0 70 70">${fruitsData[type].shape}</svg>`;
            
            // Posi√ß√£o aleat√≥ria segura
            const x = Math.random() * (window.innerWidth - 80);
            const y = Math.random() * (window.innerHeight - 150);
            
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.animation = 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            
            setupDrag(el);
            els.gameContainer.appendChild(el);
        }

        // --- SISTEMA DE ARRASTAR E SOLTAR ---
        function setupDrag(el) {
            let startX, startY, initialLeft, initialTop;

            function onStart(e) {
                if (!state.isPlaying) return;
                e.preventDefault();
                const touch = e.type === 'touchstart' ? e.touches[0] : e;
                startX = touch.clientX;
                startY = touch.clientY;
                initialLeft = el.offsetLeft;
                initialTop = el.offsetTop;
                el.style.zIndex = 1000;

                function onMove(me) {
                    const mt = me.type === 'touchmove' ? me.touches[0] : me;
                    el.style.left = (initialLeft + (mt.clientX - startX)) + 'px';
                    el.style.top = (initialTop + (mt.clientY - startY)) + 'px';
                }

                function onEnd() {
                    document.removeEventListener('mousemove', onMove);
                    document.removeEventListener('mouseup', onEnd);
                    document.removeEventListener('touchmove', onMove);
                    document.removeEventListener('touchend', onEnd);
                    el.style.zIndex = 30;
                    checkDrop(el);
                }

                document.addEventListener('mousemove', onMove);
                document.addEventListener('mouseup', onEnd);
                document.addEventListener('touchmove', onMove, {passive: false});
                document.addEventListener('touchend', onEnd);
            }

            el.addEventListener('mousedown', onStart);
            el.addEventListener('touchstart', onStart, {passive: false});
        }

        function checkDrop(el) {
            const rect = el.getBoundingClientRect();
            const cx = rect.left + rect.width/2;
            const cy = rect.top + rect.height/2;

            if (state.mode === 'normal') {
                const mouth = els.mouthSensor.getBoundingClientRect();
                if (cx >= mouth.left && cx <= mouth.right && cy >= mouth.top && cy <= mouth.bottom) {
                    if (el.dataset.type === state.targetType) {
                        eatFruitNormal(el);
                    } else {
                        rejectItem();
                    }
                }
            } else {
                // Modo Vitamina
                const blender = els.blenderSensor.getBoundingClientRect();
                if (cx >= blender.left && cx <= blender.right && cy >= blender.top && cy <= blender.bottom) {
                    checkBlenderIngredient(el);
                }
            }
        }

        function rejectItem() {
            speak("Essa n√£o!");
            playSound('pop');
        }

        // --- A√á√ïES DO MODO NORMAL ---
        function eatFruitNormal(el) {
            el.remove();
            playSound('eat');
            state.targetCount--;
            
            // Anima√ß√£o visual de engolir
            speak(state.targetCount > 0 ? "Nham!" : "Del√≠cia!");

            if (state.targetCount <= 0) {
                state.poopMeter++;
                state.isPlaying = false;
                setTimeout(startRound, 2000);
            }
        }

        // --- A√á√ïES DO MODO VITAMINA ---
        function checkBlenderIngredient(el) {
            const type = el.dataset.type;
            const needed = state.blenderRecipe[type];

            if (needed > 0) {
                // Aceita fruta
                state.blenderRecipe[type]--;
                state.blenderContent.push(type);
                el.remove();
                playSound('pop');
                
                // Verifica se acabou
                const totalRestante = Object.values(state.blenderRecipe).reduce((a,b)=>a+b, 0);
                if (totalRestante === 0) {
                    finishBlender();
                } else {
                    // Atualiza texto
                    updateBlenderText();
                }
            } else {
                // Ingrediente errado ou em excesso
                rejectItem();
            }
        }

        function updateBlenderText() {
            const parts = [];
            for (let [type, count] of Object.entries(state.blenderRecipe)) {
                if (count > 0) parts.push(`${count} ${type}`);
            }
            if(parts.length > 0) speak("Falta " + parts.join(" e "));
        }

        function finishBlender() {
            state.isPlaying = false;
            els.instruction.innerHTML = "Misturando...";
            playSound('blender');
            
            // Anima√ß√£o de bater
            els.blender.classList.add('blender-shaking');
            
            setTimeout(() => {
                els.blender.classList.remove('blender-shaking');
                els.blenderLiquid.style.opacity = 1; // Copo cheio
                speak("Vitamina pronta! Glub glub glub!");
                
                // Simula monstro bebendo
                setTimeout(() => {
                    els.blenderLiquid.style.opacity = 0;
                    state.poopMeter += 2; // Vitamina enche mais a barriga
                    startRound();
                }, 3000);
            }, 1500);
        }

        // --- UTILIT√ÅRIOS ---
        function moveEyes() {
            const left = document.getElementById('eye-left');
            const right = document.getElementById('eye-right');
            
            // Movimento aleat√≥rio simples
            const angle = Math.random() * Math.PI * 2;
            const r = 5;
            const dx = Math.cos(angle) * r;
            const dy = Math.sin(angle) * r;
            
            left.setAttribute('cx', 100 + dx); left.setAttribute('cy', 100 + dy);
            right.setAttribute('cx', 200 + dx); right.setAttribute('cy', 100 + dy);
        }

        function capitalize(s) {
            return s.charAt(0).toUpperCase() + s.slice(1);
        }
        
        setInterval(moveEyes, 2000);

    </script>
</body>
</html>
